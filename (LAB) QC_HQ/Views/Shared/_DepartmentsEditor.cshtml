@* NOTES
Departments and clearance level view, works for Edit and Create views. 
*@


@model _LAB__QC_HQ.Models.ViewModels.EditContentViewModel


<h5>Departments & Clearance</h5>

<!-- Validation message -->
@if (ViewData.ModelState["Departments"]?.Errors?.Count > 0)
{
    <div class="text-danger mb-2">
        <i class="bi bi-exclamation-triangle"></i>
        @ViewData.ModelState["Departments"].Errors.First().ErrorMessage
    </div>
}

<!-- Or show message if no departments in CREATE mode -->
@if (ViewContext.RouteData.Values["action"]?.ToString() == "Create" && Model.Departments.Count == 0)
{
    <div class="text-danger mb-2">
        <i class="bi bi-exclamation-triangle"></i>
        Please add at least one department
    </div>
}

<div id="departments-container">
    @for (int i = 0; i < Model.Departments.Count; i++)
    {
        <div class="department-entry d-flex mb-2">
            <select asp-for="Departments[i].DepartmentId" class="form-select w-auto me-2" style="flex: 2;">
                <option value="">-- Select Department --</option>
                @foreach (var dep in ViewBag.Departments)
                {
                    <option value="@dep.DepartmentId">@dep.Name</option>
                }
            </select>

            <select asp-for="Departments[i].ClearanceLevelRequired"
                    class="form-select w-auto" style="flex: 1;">
                <option value="0">0 - No Access</option>
                <option value="1">1 - Basic Access</option>
                <option value="2">2 - Advanced Access</option>
                <option value="3">3 - Full Access</option>
            </select>
            <input type="hidden"
                   name="Departments[@i].__MarkedForRemoval"
                   id="Departments[@i]__MarkedForRemoval"
                   value="false" />
        </div>
    }
</div>

<button type="button"
        class="btn btn-secondary"
        id="add-department">
    Add Department
</button>
<hr />
