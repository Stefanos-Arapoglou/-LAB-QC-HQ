@model IList<_LAB__QC_HQ.Models.DTO.CreateItemInput>

<div id="items-container">
    @for (int i = 0; i < Model.Count; i++)
    {
        bool isImage = Model[i].ItemType == "Image";
        bool isFile = Model[i].ItemType == "File";

        <div class="item-entry mb-3 border p-2 rounded position-relative">
            <!-- Hidden fields for IDs and existing values -->
            <input asp-for="@Model[i].ItemId" type="hidden" />
            <input asp-for="@Model[i].DisplayOrder" type="hidden" />
            <input asp-for="@Model[i].ItemType" type="hidden" class="item-type-hidden" />

            <!-- For existing Image/File, keep ItemValue as hidden -->
            @if (isImage || isFile)
            {
                <input asp-for="@Model[i].ItemValue" type="hidden" class="item-value-hidden" />
            }

            <!-- Display order (readonly) -->
            <input class="form-control form-control-sm order-input d-inline w-auto me-2"
                   value="@Model[i].DisplayOrder"
                   readonly />

            <!-- Title -->
            <input asp-for="@Model[i].ItemTitle"
                   class="form-control mb-1"
                   placeholder="Item title / description"
                   required />

            <!-- Type selector -->
            <select class="form-select mb-1 item-type-select">
                <option value="Text">Text</option>
                <option value="Image">Image</option>
                <option value="Link">Link</option>
                <option value="File">File</option>
            </select>

            <!-- Value (for Text/Link) -->
            <textarea asp-for="@Model[i].ItemValue"
                      class="form-control mb-1 item-value-text"
                      placeholder="Text or URL"
                      rows="1"
                      style="@(isImage || isFile ? "display:none" : "")">
                </textarea>

            <!-- Image preview if existing image -->
            @if (isImage && !string.IsNullOrEmpty(Model[i].ItemValue))
            {
                <div class="mb-1">
                    <img src="@Model[i].ItemValue" class="img-thumbnail" style="max-height: 100px;" />
                    <small class="text-muted">Current image</small>
                </div>
            }

            <!-- File upload (for new file) -->
            <input type="file"
                   class="form-control mb-1 file-upload"
                   style="@(!isImage && !isFile ? "display:none" : "")" />

            <!-- Remove button -->
            <button type="button"
                    class="btn btn-outline-danger btn-sm remove-item position-absolute top-0 end-0 m-1">
                ✖
            </button>
        </div>
    }
</div>

<button type="button" class="btn btn-secondary mb-3" id="add-item">Add Item</button>